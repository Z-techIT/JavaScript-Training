
/* ================ VARIABLE ================ */

const pixel = document.querySelector('.pixel'),
      canvas = document.getElementById('canvas'),
      colorList = document.querySelectorAll('.pixel__gallery .color'),
      root = document.documentElement,
      eraser = document.querySelector('.tool--erase'),
      images = document.querySelectorAll('img'),
      gallery = document.querySelector('.pixel__gallery'),
      btnNew = document.querySelector('.new');

let currentColor,
    ctx,
    coordX, coordY;



const popularColors = [
    "#F20505", "#05F2DB", "#F2CB05", "#F28705",
    "#4630D9", "#D90467", "#000000", "#B8BF84",
    "#BF04A0", "#BFBFBF", "#F2F2F2", "#02735E"
];


/* ================ HANDLE EVENT ================ */

const createGrid = () => {
    // Unit is rem 
    const width = 60;   // 60 rem = 600px
    const height = 50;
    
    // Rendering context and draw functions
    ctx = canvas.getContext('2d');

    // Default color of grid canvas
    let first = '#ffffff', second = '#e0e0e0';

    for(let i = 0; i < height; i++) {
        // Swap color 
        [first, second] = [second, first];
        for(let j = 0; j < width; j++) {
            ctx.fillStyle = j % 2 ? first : second;
            ctx.fillRect(j * 10, i * 10, 10, 10);
        }
    }
}

const init = () => {
    currentColor = '#000';

    // Create colors table 
    [...colorList].forEach((c, i) => c.style.backgroundColor = popularColors[i]);
    
    // Create grid area for painting
    createGrid();

    coordX = canvas.getBoundingClientRect().x - pixel.getBoundingClientRect().x;
    coordY = canvas.getBoundingClientRect().y - pixel.getBoundingClientRect().y;
}

// const activatedMouseover = 

const paint = e => {
    e.preventDefault();
    
    // Round coord of box that is clicked
    const x = Math.trunc((e.layerX - coordX) / 10) * 10,
          y = Math.trunc((e.layerY - coordY) / 10) * 10;
    ctx.fillStyle = 'red';
    ctx.fillRect(x, y, 10, 10);
}


const pickColor = e => {
    currentColor = window.getComputedStyle(e.target).backgroundColor;
    document.documentElement.style.setProperty('--color-current', currentColor);
    // console.log(currentColor);
}


// use mousemove event instead of mouseover because mouse will change the first element while mouseover will change the second element.
const activatedMousemove = () => canvas.addEventListener('mousemove', paint);
const unActivatedMousemove = () => canvas.removeEventListener('mousemove', paint);

window.addEventListener('load', init);

canvas.addEventListener('mousedown', activatedMousemove);
canvas.addEventListener('mouseup', unActivatedMousemove);
canvas.addEventListener('mouseout', unActivatedMousemove);
canvas.addEventListener('click', paint);
canvas.addEventListener('contextmenu', e => e.preventDefault());



gallery.addEventListener('click', pickColor);

btnNew.addEventListener('click', createGrid);